<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMRS HR - Manajemen SDM Terpadu</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Add Noto Sans Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#17B8A5',
                        primaryDark: '#0F8F80',
                        secondary: '#FFE17A',
                        darkBg: '#111827',
                        darkCard: '#1F2937',
                    },
                    fontFamily: {
                        sans: ['Noto Sans', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Noto Sans', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        .dark ::-webkit-scrollbar-track { background: #374151; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #4b5563; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }

        .typing-dot { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .bg-pattern { background-image: radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px); background-size: 20px 20px; }
    </style>
</head>
<body class="bg-[#F7F7F7] text-[#2C2C2C] dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div id="root"></div>

    <!-- React Application -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            LayoutDashboard, Users, UserPlus, Activity, Search, Menu, 
            FileText, AlertTriangle, Trash2, Upload, Clock, Briefcase, 
            Award, BookOpen, Filter, MoreVertical, Eye, Edit, X, ChevronRight,
            ChevronDown, CheckCircle, Phone, Mail, MapPin, Calendar, User,
            Target, UserCheck, GraduationCap, FileBarChart, Save,
            Sun, Cloud, Moon, Shield, Stethoscope, Image as ImageIcon,
            Bot, Send, Settings, LogOut, Camera, Lock, Palette,
            EyeOff, AlertCircle
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- API CONFIGURATION ---
        const API_URL = 'http://localhost:3000/api';

        // --- CONSTANTS ---
        const JOB_CATEGORIES = {
            MEDIS: ['Dokter Spesialis', 'Dokter Umum', 'Dokter Gigi'],
            KEPERAWATAN: ['Perawat', 'Bidan'],
            PENUNJANG: ['Farmasi', 'Laboratorium', 'Radiologi', 'Gizi', 'Fisioterapi', 'Rekam Medis'],
            NON_MEDIS: ['Manajemen & Admin', 'Keuangan', 'IT & SIMRS', 'Teknik (IPSRS)', 'Keamanan', 'Layanan Umum']
        };

        const UNIT_MAPPING = {
            'Dokter Spesialis': ["Poli Penyakit Dalam", "Poli Bedah Umum", "Poli Anak", "Poli Kandungan (Obgyn)", "Poli Mata", "Poli THT", "Poli Saraf", "Poli Jantung", "Poli Kulit & Kelamin", "Poli Kejiwaan", "Poli Rehabilitasi Medik", "Poli Orthopedi", "Rawat Inap Utama", "ICU / ICCU", "Kamar Operasi (IBS)"],
            'Dokter Umum': ["Instalasi Gawat Darurat (IGD)", "Poli Umum", "Unit Medical Check Up (MCU)"],
            'Dokter Gigi': ["Poli Gigi & Mulut"],
            'Perawat': ["Instalasi Gawat Darurat (IGD)", "Rawat Inap (Lt 1)", "Rawat Inap (Lt 2)", "Rawat Inap (VIP)", "ICU / ICCU", "Kamar Operasi (IBS)", "Poli Umum", "Poli Spesialis", "Hemodialisa", "Poli Kejiwaan", "Poli Rehabilitasi Medik"],
            'Bidan': ["Kamar Bersalin (VK)", "Poli Kandungan (Obgyn)", "Ruang Nifas"],
            'Farmasi': ["Instalasi Farmasi (Depot Rawat Jalan)", "Instalasi Farmasi (Depot Rawat Inap)", "Gudang Farmasi"],
            'Laboratorium': ["Laboratorium Patologi Klinik", "Laboratorium Patologi Anatomi", "Bank Darah"],
            'Radiologi': ["Instalasi Radiologi"],
            'Gizi': ["Instalasi Gizi (Dapur)", "Poli Gizi"],
            'Fisioterapi': ["Unit Rehabilitasi Medik"],
            'Rekam Medis': ["Unit Rekam Medis & Pendaftaran"],
            'Manajemen & Admin': ["Front Office", "Back Office", "HRD & Diklat", "Keuangan"],
            'Keuangan': ["Kasir", "Akuntansi"],
            'IT & SIMRS': ["Ruang Server & IT Support"],
            'Teknik (IPSRS)': ["Maintenance & Teknisi"],
            'Keamanan': ["Pos Security Utama", "Pos Security IGD", "Patroli"],
            'Layanan Umum': ["Cleaning Service", "Laundry", "Supir Ambulans", "Sanitasi & Kebersihan"]
        };

        const REQUIRED_SIP_DOCS = [...JOB_CATEGORIES.MEDIS, ...JOB_CATEGORIES.KEPERAWATAN, ...JOB_CATEGORIES.PENUNJANG];

        // --- COMPONENTS UTILS ---
        
        // Custom Toast Notification
        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const bgClass = type === 'success' ? 'bg-green-600' : 'bg-red-600';
            const icon = type === 'success' ? <CheckCircle size={20}/> : <AlertTriangle size={20}/>;

            return (
                <div className={`fixed top-5 right-5 z-[100] ${bgClass} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 animate-slide-in`}>
                    {icon}
                    <span className="font-bold text-sm">{message}</span>
                    <button onClick={onClose}><X size={16}/></button>
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, children, large = false }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
                    <div className={`bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full ${large ? 'max-w-4xl' : 'max-w-3xl'} max-h-[90vh] overflow-hidden flex flex-col border border-gray-100 dark:border-gray-700`}>
                        <div className="flex justify-between items-center p-5 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                            <h3 className="text-lg font-bold text-gray-800 dark:text-white">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-500 dark:text-gray-400 transition-colors"><X size={20}/></button>
                        </div>
                        <div className="p-0 overflow-y-auto flex-1">{children}</div>
                    </div>
                </div>
            );
        };

        // --- AUTH & LOGIN ---
        const InputField = ({ label, type, placeholder, icon: Icon, value, onChange }) => {
            const [showPass, setShowPass] = useState(false);
            const isPassword = type === 'password';
            
            return (
                <div className="space-y-1.5">
                    <label className="text-sm font-semibold text-gray-700">{label}</label>
                    <div className="relative group">
                        <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-[#17B8A5] transition-colors"><Icon size={18} /></div>
                        <input 
                            type={isPassword && showPass ? 'text' : type}
                            className="w-full pl-10 pr-10 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#17B8A5] bg-gray-50 focus:bg-white text-sm transition-all"
                            placeholder={placeholder} 
                            value={value} 
                            onChange={onChange}
                        />
                        {isPassword && (
                            <button type="button" onClick={() => setShowPass(!showPass)} className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-700">
                                {showPass ? <EyeOff size={18}/> : <Eye size={18}/>}
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const AuthPage = ({ onLogin }) => {
            const [isRegister, setIsRegister] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [formData, setFormData] = useState({ name: '', email: '', password: '', confirmPassword: '' });
            const [error, setError] = useState('');
            const [successMsg, setSuccessMsg] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setSuccessMsg('');
                setIsLoading(true);

                if (!formData.email || !formData.password) {
                    setError('Harap isi email dan password.'); 
                    setIsLoading(false); return;
                }

                try {
                    const endpoint = isRegister ? '/auth/daftar' : '/auth/masuk';
                    const payload = isRegister 
                        ? { nama: formData.nama, email: formData.email, password: formData.password }
                        : { email: formData.email, password: formData.password };

                    if (isRegister && formData.password !== formData.confirmPassword) {
                        setError('Konfirmasi password tidak cocok.'); setIsLoading(false); return;
                    }

                    const response = await fetch(`${API_URL}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    const data = await response.json();

                    if (response.ok) {
                        if (isRegister) {
                            setSuccessMsg("Registrasi Berhasil! Silakan masuk.");
                            setIsRegister(false);
                            setFormData({ nama: '', email: '', password: '', confirmPassword: '' });
                        } else {
                            onLogin(data.user);
                        }
                    } else {
                        setError(data.error || 'Terjadi kesalahan pada server.');
                    }
                } catch (err) {
                    setError('Gagal terhubung ke backend.');
                } finally {
                    setIsLoading(false);
                }
            };

            const BrandSidebar = () => (
                <div className="hidden lg:flex w-1/2 bg-[#17B8A5] relative overflow-hidden flex-col justify-between p-12 text-white h-screen fixed left-0 top-0">
                    <div className="absolute inset-0 bg-pattern opacity-30"></div>
                    <div className="relative z-10 flex items-center gap-3">
                        <div className="bg-white p-2 rounded-lg text-[#17B8A5]"><Activity size={32} strokeWidth={2.5} /></div>
                        <h1 className="text-3xl font-bold tracking-tight">SIMRS <span className="font-light opacity-90">HR</span></h1>
                    </div>
                    <div className="relative z-10 space-y-6">
                        <h2 className="text-4xl font-bold leading-tight">Sistem Kepegawaian <br/> Rumah Sakit.</h2>
                        <p className="text-teal-50 text-lg font-light max-w-md">Kelola akses masuk staf medis dan administrasi dengan aman dan terintegrasi.</p>
                    </div>
                    <div className="relative z-10 text-xs opacity-60">&copy; 2024 SIMRS HR System.</div>
                </div>
            );

            return (
                <div className="min-h-screen flex w-full bg-white lg:bg-[#F7F7F7]">
                    <BrandSidebar />
                    <div className="w-full lg:w-1/2 lg:ml-auto flex items-center justify-center p-8 lg:p-16 bg-white animate-fade-in min-h-screen">
                        <div className="w-full max-w-md space-y-8">
                            <div className="text-center lg:text-left">
                                <h2 className="text-3xl font-bold text-gray-800">{isRegister ? 'Buat Akun Baru' : 'Selamat Datang'}</h2>
                                <p className="text-gray-500 mt-2">{isRegister ? 'Lengkapi data untuk akses SIMRS.' : 'Masuk untuk mengakses dashboard.'}</p>
                            </div>
                            {error && <div className="bg-red-50 text-red-600 p-4 rounded-xl text-sm flex items-start gap-3 border border-red-100"><AlertCircle className="shrink-0 mt-0.5" size={16}/> <span>{error}</span></div>}
                            {successMsg && <div className="bg-green-50 text-green-700 p-4 rounded-xl text-sm flex items-start gap-3 border border-green-100"><CheckCircle className="shrink-0 mt-0.5" size={16}/> <span>{successMsg}</span></div>}
                            
                            <form onSubmit={handleSubmit} className="space-y-5">
                                {isRegister && <InputField label="Nama Lengkap" type="text" placeholder="Contoh: dr. Budi Santoso" icon={User} value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />}
                                <InputField label="Email" type="email" placeholder="nama@rs.com" icon={Mail} value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} />
                                <InputField label="Password" type="password" placeholder="Minimal 6 karakter" icon={Lock} value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} />
                                {isRegister && <InputField label="Konfirmasi Password" type="password" placeholder="Ulangi password" icon={CheckCircle} value={formData.confirmPassword} onChange={e => setFormData({...formData, confirmPassword: e.target.value})} />}
                                <button type="submit" disabled={isLoading} className="w-full bg-[#17B8A5] hover:bg-[#129485] text-white font-bold py-3.5 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 mt-6 disabled:opacity-70">{isLoading ? 'Memproses...' : (isRegister ? 'Daftar Sekarang' : 'Masuk Dashboard')}</button>
                            </form>
                            <div className="text-center pt-4 border-t border-gray-100 mt-6"><p className="text-sm text-gray-600">{isRegister ? 'Sudah punya akun? ' : 'Belum punya akun? '}<button onClick={() => {setIsRegister(!isRegister); setError('');}} className="text-[#17B8A5] font-bold hover:underline ml-1">{isRegister ? 'Masuk sekarang' : 'Daftar di sini'}</button></p></div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- DASHBOARD & MODULES ---
        const Dashboard = ({ staffData }) => {
            const [modalData, setModalData] = useState({ isOpen: false, title: '', list: [] });
            
            const getSipWarnings = () => staffData.map(staff => {
                if (!staff.sipExpiry || staff.sipExpiry === '-') return null;
                const sipDate = new Date(staff.sipExpiry);
                const diffDays = Math.ceil((sipDate - new Date()) / (1000 * 60 * 60 * 24));
                if (diffDays <= 30) return { ...staff, warningStatus: 'red', daysLeft: diffDays };
                if (diffDays <= 90) return { ...staff, warningStatus: 'orange', daysLeft: diffDays };
                if (diffDays <= 180) return { ...staff, warningStatus: 'yellow', daysLeft: diffDays };
                return null;
            }).filter(Boolean).sort((a,b) => a.daysLeft - b.daysLeft);

            const warningList = getSipWarnings();
            const getCount = (cats) => staffData.filter(s => cats.includes(s.category)).length;

            const WidgetCard = ({ title, count, icon: Icon, colorClass, borderColorClass }) => (
                <div className={`bg-white dark:bg-gray-800 p-5 rounded-xl shadow-sm border-l-4 ${borderColorClass} cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all group`}>
                    <div className="flex justify-between items-start">
                        <div><p className="text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-wider">{title}</p><h3 className="text-3xl font-bold text-gray-800 dark:text-white mt-2">{count}</h3></div>
                        <div className={`p-3 rounded-lg bg-gray-50 dark:bg-gray-700 ${colorClass}`}><Icon size={24} /></div>
                    </div>
                </div>
            );

            return (
                <div className="space-y-8 animate-fade-in">
                    <div><h2 className="text-2xl font-bold text-[#2C2C2C] dark:text-white">Dashboard Operasional SDM</h2><p className="text-gray-500 dark:text-gray-400 text-sm">Ringkasan data pegawai dan status operasional hari ini.</p></div>
                    {warningList.length > 0 && (
                        <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4 rounded-xl flex items-center justify-between shadow-sm">
                            <div className="flex items-center gap-3"><div className="p-2 bg-red-100 dark:bg-red-800 rounded-full text-red-600 dark:text-red-200 animate-pulse"><AlertTriangle size={24} /></div><div><h3 className="font-bold text-red-800 dark:text-red-200 text-lg">Peringatan: {warningList.length} SIP Pegawai Perlu Perhatian</h3></div></div>
                        </div>
                    )}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <WidgetCard title="Dokter" count={getCount(JOB_CATEGORIES.MEDIS)} icon={Stethoscope} colorClass="text-[#17B8A5]" borderColorClass="border-[#17B8A5]" />
                        <WidgetCard title="Perawat" count={getCount(JOB_CATEGORIES.KEPERAWATAN)} icon={Users} colorClass="text-pink-500" borderColorClass="border-pink-500" />
                        <WidgetCard title="Penunjang" count={getCount(JOB_CATEGORIES.PENUNJANG)} icon={Activity} colorClass="text-purple-500" borderColorClass="border-purple-500" />
                        <WidgetCard title="Non-Medis" count={getCount(JOB_CATEGORIES.NON_MEDIS)} icon={Shield} colorClass="text-gray-600" borderColorClass="border-gray-600" />
                    </div>
                </div>
            );
        };

        const StaffDirectory = ({ staffData, onDelete, onUpdate }) => {
            const [search, setSearch] = useState('');
            const [editingStaff, setEditingStaff] = useState(null);
            
            // Filter logic
            const filteredData = staffData.filter(s => 
                s.name.toLowerCase().includes(search.toLowerCase()) || 
                s.unit.toLowerCase().includes(search.toLowerCase())
            );

            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold dark:text-white">Direktori Pegawai</h2>
                        <div className="relative"><Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={18} /><input type="text" placeholder="Cari Nama / Unit..." className="pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-700 dark:text-white focus:outline-none focus:border-[#17B8A5]" value={search} onChange={(e) => setSearch(e.target.value)}/></div>
                    </div>
                    <div className="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <table className="w-full text-left">
                            <thead className="bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 text-gray-500 dark:text-gray-400 font-bold text-xs uppercase"><tr><th className="px-6 py-4">Nama</th><th className="px-6 py-4">Unit</th><th className="px-6 py-4">Jabatan</th><th className="px-6 py-4 text-right">Aksi</th></tr></thead>
                            <tbody className="divide-y divide-gray-100 dark:divide-gray-700 dark:text-gray-200">{filteredData.map(s => (
                                <tr key={s.id} className="hover:bg-gray-50 dark:hover:bg-gray-700">
                                    <td className="px-6 py-4 font-bold">{s.name}</td>
                                    <td className="px-6 py-4 text-sm">{s.unit}</td>
                                    <td className="px-6 py-4 text-sm">{s.role}</td>
                                    <td className="px-6 py-4 text-right flex justify-end gap-2">
                                        <button onClick={() => onDelete(s.id)} className="text-red-500 hover:bg-red-50 p-2 rounded"><Trash2 size={16}/></button>
                                    </td>
                                </tr>
                            ))}</tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const StaffForm = ({ onAddStaff, showToast }) => {
            const [formData, setFormData] = useState({ 
                employeeId: '', name: '', role: '', unit: '', category: 'Dokter Umum', employeeType: 'Tetap', 
                sipNumber: '', sipExpiry: '', gender: 'Laki-laki', birthPlace: '', birthDate: '', phone: '', email: '', address: '', joinDate: new Date().toISOString().split('T')[0]
            });
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const res = await fetch(`${API_URL}/staff`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    const data = await res.json();
                    if (res.ok) {
                        onAddStaff(data);
                        showToast('Data berhasil disimpan!', 'success');
                    } else {
                        showToast('Gagal menyimpan data.', 'error');
                    }
                } catch(err) {
                    showToast('Error koneksi server.', 'error');
                }
            };

            const handleChange = (e) => setFormData({...formData, [e.target.name]: e.target.value});

            return (
                <div className="space-y-6 animate-fade-in max-w-4xl mx-auto">
                    <h2 className="text-2xl font-bold dark:text-white">Input Data SDM</h2>
                    <form onSubmit={handleSubmit} className="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label className="text-xs font-bold text-gray-500 uppercase">Nama Lengkap</label><input required name="name" value={formData.name} onChange={handleChange} className="w-full mt-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:text-white"/></div>
                        <div><label className="text-xs font-bold text-gray-500 uppercase">ID Pegawai</label><input required name="employeeId" value={formData.employeeId} onChange={handleChange} className="w-full mt-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:text-white"/></div>
                        <div><label className="text-xs font-bold text-gray-500 uppercase">Unit</label><input required name="unit" value={formData.unit} onChange={handleChange} className="w-full mt-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:text-white"/></div>
                        <div><label className="text-xs font-bold text-gray-500 uppercase">Jabatan</label><input required name="role" value={formData.role} onChange={handleChange} className="w-full mt-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:text-white"/></div>
                        <div className="md:col-span-2"><button type="submit" className="w-full bg-[#17B8A5] text-white font-bold py-3 rounded-lg hover:bg-[#0F8F80]">Simpan Data</button></div>
                    </form>
                </div>
            );
        };

        const PerformanceModule = ({ staffData }) => {
            const [kinerjaData, setKinerjaData] = useState([]);
            
            // Explicitly fetch from /api/kinerjaStaff/ as requested
            useEffect(() => {
                fetch(`${API_URL}/kinerjaStaff`)
                    .then(res => res.json())
                    .then(data => setKinerjaData(data))
                    .catch(err => console.error(err));
            }, [staffData]); // Reload if staff changes

            return (
                <div className="space-y-6 animate-fade-in">
                    <h2 className="text-2xl font-bold dark:text-white">Evaluasi Kinerja</h2>
                    <div className="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        {kinerjaData.length === 0 ? <p className="text-gray-500">Belum ada data kinerja.</p> : (
                            <ul className="space-y-3">
                                {kinerjaData.map(k => (
                                    <li key={k.id} className="p-4 border rounded-lg flex justify-between items-center dark:border-gray-700">
                                        <div><p className="font-bold dark:text-white">{k.name}</p><p className="text-xs text-gray-500">{k.role}</p></div>
                                        <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">Aktif</span>
                                    </li>
                                ))}
                            </ul>
                        )}
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [staffData, setStaffData] = useState([]);
            const [toast, setToast] = useState(null);

            // Fetch Staff on Login
            useEffect(() => {
                if (user) {
                    fetch(`${API_URL}/staff`)
                        .then(res => res.json())
                        .then(data => { if(Array.isArray(data)) setStaffData(data); })
                        .catch(console.error);
                }
            }, [user]);

            const showToast = (msg, type) => setToast({ message: msg, type });

            // DELETE handler
            const handleDelete = async (id) => {
                if(!confirm("Hapus data ini?")) return;
                try {
                    await fetch(`${API_URL}/staff/${id}`, { method: 'DELETE' });
                    setStaffData(prev => prev.filter(s => s.id !== id));
                    showToast('Data terhapus', 'success');
                } catch(e) { showToast('Gagal menghapus', 'error'); }
            };

            if (!user) return <AuthPage onLogin={setUser} />;

            return (
                <div className="flex min-h-screen font-sans pl-64 bg-[#F7F7F7] dark:bg-gray-900 transition-colors">
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    
                    <div className="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col h-screen fixed left-0 top-0 z-50">
                        <div className="h-16 flex items-center justify-center border-b border-gray-200 dark:border-gray-700"><h1 className="text-2xl font-bold text-[#17B8A5]">SIMRS<span className="text-gray-800 dark:text-white">HR</span></h1></div>
                        <nav className="p-4 space-y-2 flex-1">
                            {[{ id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' }, { id: 'directory', icon: Users, label: 'Direktori' }, { id: 'crud', icon: UserPlus, label: 'Input Data' }, { id: 'performance', icon: Activity, label: 'Kinerja' }].map(item => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition ${activeTab === item.id ? 'bg-[#17B8A5] text-white shadow-md' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}`}><item.icon size={20}/> {item.label}</button>
                            ))}
                        </nav>
                        <div onClick={() => setUser(null)} className="p-4 border-t border-gray-100 cursor-pointer hover:bg-gray-50 flex items-center gap-3"><div className="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center font-bold text-gray-500">{user.name.substring(0,2)}</div><div className="text-sm font-bold text-gray-700">{user.name}</div><LogOut size={16} className="ml-auto text-red-400"/></div>
                    </div>

                    <main className="flex-1 p-8 h-screen overflow-y-auto">
                        {activeTab === 'dashboard' && <Dashboard staffData={staffData} />}
                        {activeTab === 'directory' && <StaffDirectory staffData={staffData} onDelete={handleDelete} />}
                        {activeTab === 'crud' && <StaffForm onAddStaff={s => setStaffData([s, ...staffData])} showToast={showToast} />}
                        {activeTab === 'performance' && <PerformanceModule staffData={staffData} />}
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>